# Attestation Overview

Attestation is a security mechanism that allows a client to **verify the identity and integrity of a remote system before sending sensitive data**.

In the context of confidential computing, attestation provides cryptographic proof that an application is running:

- Inside a **Trusted Execution Environment (TEE)**
- With **expected software and configuration**
- Without interference from the host operating system, hypervisor, or cloud provider

Attestation is a foundational building block for **zero-trust architectures**, where trust is never assumed and must always be verified.  

For Cube AI, attestation ensures that sensitive prompts, embeddings, and responses are processed only by trusted and verified AI services.

---

## Attestation and Attested TLS (aTLS)

To allow clients to send confidential data to Cube AI securely, a secure channel based on **Attested TLS (aTLS)** is established.  

aTLS is a standard TLS connection augmented with a **hardware-backed attestation report** proving that the remote service is running inside a **Trusted Execution Environment (TEE)**.

In Cube AI, the Embeddings Service acts as the TLS server and extends its **X.509 certificate** with an attestation report generated by the underlying TEE (e.g. AMD SEV-SNP).

When generating the attestation report, the service embeds the **hash of its ephemeral public key** into the `report_data` field of the attestation report.  

A new TLS certificate and a fresh attestation report are generated for every connection, ensuring cryptographic freshness and preventing replay attacks.

This provides cryptographic proof that the client is communicating directly with the Cube AI service running inside a TEE, and not with the host system or any intermediary.

---

## Local Proxy-Based Attestation

Unlike other systems where users must manually perform attestation using a CLI tool, Cube AI fully automates the attestation process through a **Local Proxy** installed on the user's machine.

The Cube AI Local Proxy:

- Establishes the **aTLS connection** to the Cube AI Embeddings Service
- Retrieves and verifies the attestation report
- Validates enclave identity and security measurements
- Ensures the TLS key is cryptographically bound to the attested TEE
- Transparently forwards requests and responses

From the user's perspective, the client application communicates with the Proxy over **standard HTTPS**, while all attestation logic is handled automatically.

---

## Attestation Policy Verification

The Local Proxy enforces an **attestation policy** that defines the expected properties of the TEE.

This policy includes:

- Reference values for fields in the attestation report
- Expected measurements identifying the Cube AI Embeddings Service
- Verification that the TLS key is bound to the attested enclave

Only if the attestation report satisfies the policy will the Proxy establish and maintain the aTLS connection.

---

## Security Guarantees

This design ensures that:

- Plaintext input is visible only inside the TEE
- Embeddings are generated exclusively within the enclave
- The host OS, hypervisor, and cloud provider cannot access user data
- No manual attestation steps are required from users
- The client can trust the identity and integrity of the remote service
